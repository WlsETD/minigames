<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DevsLite - å¯«ç¨‹å¼è¨è«–å€ (Vue3 + IndexedDB)</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.min.css">

  <style>
    :root{
      --bg:#f4f6f8;
      --panel:#ffffff;
      --line:#dfe6ee;
      --text:#1f2a37;
      --muted:#6b7280;
      --brand:#1d4ed8;
      --brand2:#2563eb;
      --danger:#dc2626;
      --warn:#b45309;
      --ok:#047857;

      --shadow: 0 10px 24px rgba(0,0,0,.06);
      --r:10px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans TC", "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:var(--sans);background:var(--bg);color:var(--text)}
    a{color:inherit;text-decoration:none}
    button,input,textarea,select{font-family:inherit}
    .container{max-width:1220px;margin:0 auto;padding:18px 16px 36px}

    /* NAV */
    .nav{
      position:sticky;top:0;z-index:50;
      background:rgba(255,255,255,.92);
      border-bottom:1px solid var(--line);
      backdrop-filter: blur(10px);
    }
    .nav-inner{max-width:1220px;margin:0 auto;padding:10px 16px;display:flex;gap:12px;align-items:center}
    .brand{display:flex;align-items:center;gap:10px;font-weight:900}
    .brand .dot{width:10px;height:10px;border-radius:999px;background:var(--brand2)}
    .brand b{color:#111827}
    .nav-links{display:flex;gap:10px;align-items:center;color:#374151;font-weight:650}
    .nav-links a{padding:8px 10px;border-radius:8px}
    .nav-links a:hover{background:#f3f4f6}
    .spacer{flex:1}
    .search{
      display:flex;align-items:center;gap:8px;
      border:1px solid var(--line);
      background:#fff;border-radius:999px;
      padding:8px 12px;
      min-width: 280px;
      box-shadow: 0 1px 0 rgba(0,0,0,.02);
    }
    .search input{border:0;outline:0;width:100%;font-size:14px}
    .chip{
      border:1px solid var(--line);
      background:#fff;border-radius:999px;
      padding:8px 12px;
      cursor:pointer;font-weight:750;font-size:13px;
    }
    .chip.primary{border-color:#c7d2fe;background:#eef2ff;color:#1e3a8a}
    .chip.danger{border-color:#fecaca;background:#fff1f2;color:#9f1239}
    .me{display:flex;gap:10px;align-items:center;position:relative}
    .avatar{
      width:34px;height:34px;border-radius:999px;
      display:grid;place-items:center;
      background:#eef2ff;border:1px solid #c7d2fe;
      font-weight:900;color:#1e3a8a;
      cursor:pointer;
    }
    .dropdown{
      position:absolute;right:0;top:44px;width:240px;
      background:#fff;border:1px solid var(--line);
      border-radius:12px;box-shadow:var(--shadow);
      padding:8px;
    }
    .drop-item{
      padding:10px;border-radius:10px;
      display:flex;justify-content:space-between;align-items:center;
      cursor:pointer;font-weight:700;
    }
    .drop-item:hover{background:#f3f4f6}
    .badge{
      font-size:12px;font-weight:800;
      padding:4px 8px;border-radius:999px;
      border:1px solid var(--line);
      background:#f9fafb;color:#374151;
    }
    .badge.blue{border-color:#c7d2fe;background:#eef2ff;color:#1e3a8a}
    .badge.green{border-color:#bbf7d0;background:#ecfdf5;color:#065f46}
    .badge.orange{border-color:#fed7aa;background:#fff7ed;color:#9a3412}

    /* Top notice + info */
    .notice{
      background:#fee2e2;border:1px solid #fecaca;color:#7f1d1d;
      padding:10px 12px;border-radius:10px;
      display:flex;gap:10px;align-items:center;
      margin-top:14px;
      display: none;
    }
    .notice b{font-weight:900}
    .info{
      background:#dbeafe;border:1px solid #bfdbfe;color:#1e3a8a;
      padding:12px;border-radius:10px;
      margin-top:12px;
      display:flex;gap:12px;align-items:center;flex-wrap:wrap;
      display: none;
    }
    .info .pill{width:10px;height:10px;border-radius:999px;background:var(--brand2)}
    .muted{color:var(--muted)}
    .layout{
      display:grid;grid-template-columns: 260px 1fr 300px;gap:14px;
      margin-top:14px;
    }
    @media (max-width: 1020px){
      .layout{grid-template-columns: 1fr}
      .search{min-width:0;flex:1}
      .nav-links{display:none}
    }

    /* Panels */
    .panel{
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:12px;
      box-shadow: var(--shadow);
    }
    .panel .head{
      padding:12px;border-bottom:1px solid var(--line);
      font-weight:900;color:#111827;
      display:flex;justify-content:space-between;align-items:center;gap:10px;
    }
    .panel .body{padding:12px}
    .small{font-size:12.5px}
    .hr{height:1px;background:var(--line);margin:12px 0}

    /* Post list */
    .post{
      padding:12px;border:1px solid var(--line);
      border-radius:12px;background:#fff;
      cursor:pointer;
    }
    .post:hover{background:#fbfdff}
    .post .row1{display:flex;gap:10px;align-items:flex-start;justify-content:space-between}
    .post h3{margin:0;font-size:16px;line-height:1.3}
    .post .meta{margin-top:8px;color:var(--muted);font-size:12.5px;display:flex;gap:10px;flex-wrap:wrap}
    .excerpt{margin-top:10px;color:#374151;font-size:13.5px;line-height:1.55}
    .list{display:flex;flex-direction:column;gap:10px}

    /* Thread */
    .thread-title{margin:0;font-size:20px}
    .thread-actions{display:flex;gap:8px;flex-wrap:wrap}
    .btn{
      border:1px solid var(--line);
      background:#fff;border-radius:10px;
      padding:9px 12px;font-weight:850;
      cursor:pointer;
    }
    .btn:hover{background:#f3f4f6}
    .btn.primary{border-color:#c7d2fe;background:#eef2ff;color:#1e3a8a}
    .btn.danger{border-color:#fecaca;background:#fff1f2;color:#9f1239}
    .btn.block{width:100%}
    .field{display:flex;flex-direction:column;gap:8px;margin-top:12px}
    .field label{font-size:12.5px;color:var(--muted);font-weight:800}
    .input,.textarea,.select{
      border:1px solid var(--line);
      border-radius:10px;
      padding:10px 12px;
      font-size:14px;outline:0;background:#fff;
    }
    .textarea{min-height:120px;resize:vertical;line-height:1.6}
    .two{display:grid;grid-template-columns: 1fr 1fr;gap:10px}
    @media (max-width: 700px){ .two{grid-template-columns: 1fr} }

    .img-grid{display:grid;grid-template-columns: repeat(2, 1fr);gap:10px;margin-top:12px}
    @media (max-width: 700px){ .img-grid{grid-template-columns: 1fr} }
    .img{
      border:1px solid var(--line);
      border-radius:12px;overflow:hidden;background:#fff;
    }
    .img img{width:100%;height:auto;display:block}

    /* Code box */
    .codebox{
      margin-top:12px;border:1px solid var(--line);
      border-radius:12px;overflow:hidden;background:#f8fafc;
    }
    .code-top{
      display:flex;justify-content:space-between;align-items:center;
      padding:10px 12px;border-bottom:1px solid var(--line);
      background:#fff;
    }
    .code-top .left{display:flex;gap:8px;align-items:center}
    .mini{
      border:1px solid var(--line);background:#fff;border-radius:999px;
      padding:7px 10px;cursor:pointer;font-weight:850;font-size:12px;
    }
    .mini:hover{background:#f3f4f6}
    pre{margin:0}
    pre code{font-family:var(--mono);font-size:13px}

    /* Comments */
    .comment{
      border:0;
      border-radius:12px;padding:12px;background:transparent;margin-top:10px;
      color: #047857;
    }
    .comment .top{display:flex;justify-content:space-between;gap:10px;align-items:center}
    .comment .meta{font-size:12.5px;color:var(--muted);display:flex;gap:10px;flex-wrap:wrap}
    .comment .body{margin-top:8px;white-space:pre-wrap;line-height:1.7;color:#374151}

    /* Left / Right lists */
    .user-row, .reply-row{
      display:flex;gap:10px;align-items:center;
      padding:9px;border-radius:10px;cursor:pointer;
    }
    .user-row:hover, .reply-row:hover{background:#f3f4f6}
    .uava{
      width:34px;height:34px;border-radius:999px;
      display:grid;place-items:center;font-weight:900;
      background:#f3f4f6;border:1px solid var(--line);color:#111827;
      flex:0 0 auto;
    }
    .reply-row .t{font-weight:900;font-size:13.5px;line-height:1.2}
    .reply-row .s{font-size:12.5px;color:var(--muted);margin-top:4px}
    .toast{
      position:fixed;left:50%;bottom:18px;transform:translateX(-50%);
      background:#111827;color:#fff;
      padding:10px 12px;border-radius:999px;
      font-weight:850;font-size:13px;
      box-shadow: 0 14px 26px rgba(0,0,0,.16);
      max-width: 92vw;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }

    /* Auth modal */
    .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:80;display:flex;align-items:center;justify-content:center;padding:16px}
    .modal{width:520px;max-width:100%;background:#fff;border:1px solid var(--line);border-radius:12px;box-shadow:var(--shadow);overflow:hidden}
    .modal .mhead{padding:12px;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;align-items:center;font-weight:950}
    .x{border:1px solid var(--line);background:#fff;border-radius:10px;padding:7px 10px;cursor:pointer;font-weight:900}
    .x:hover{background:#f3f4f6}
    .tabs{display:flex;gap:10px}
    .tab{flex:1;text-align:center;padding:10px;border:1px solid var(--line);border-radius:10px;font-weight:950;cursor:pointer;background:#fff}
    .tab.active{border-color:#c7d2fe;background:#eef2ff;color:#1e3a8a}
  </style>
</head>

<body>
<div id="app">
  <!-- NAV -->
  <div class="nav">
    <div class="nav-inner" @click="menuOpen=false">
      <a class="brand" href="#" @click.prevent="goHome()">
        <span class="dot"></span>
        <b>DevsLite</b> <span class="muted small">å¯«ç¨‹å¼è¨è«–å€</span>
      </a>

      <div class="nav-links">
        <a href="#" @click.prevent="goHome()">å…¨éƒ¨è²¼æ–‡</a>
        <a href="#" @click.prevent="filterMode='original'; goHome()">åŸå‰µç™¼è¡¨</a>
        <a href="#" @click.prevent="filterMode='series'; goHome()">ç³»åˆ—æ–‡ç« </a>
        <a href="#" @click.prevent="panel='contributors'; goHome()">è²¢ç»è€…</a>
        <a href="#" @click.prevent="panel='community'; goHome()">ç¤¾ç¾¤</a>
      </div>

      <div class="spacer"></div>

      <div class="search" @click.stop>
        <span class="muted" style="font-weight:900">æœå°‹æ–‡ç« </span>
        <input v-model.trim="q" placeholder="æ¨™é¡Œ / å…§å®¹ / ä½œè€… / æ¨™ç±¤" />
      </div>

      <button class="chip primary" @click.stop="goNew()">ç™¼è¡¨æ–‡ç« </button>

      <div class="me" @click.stop>
        <template v-if="me">
          <div class="avatar" @click="toggleMenu()">{{ me.username.slice(0,1).toUpperCase() }}</div>
          <div class="chip" @click="toggleMenu()">{{ me.username }}</div>
          <div class="dropdown" v-if="menuOpen">
            <div class="drop-item">
              <span>ç‹€æ…‹</span><span class="badge green">Online</span>
            </div>
            <div class="drop-item" @click="goNew(); menuOpen=false">
              <span>æ–°å¢è²¼æ–‡</span><span class="muted">Ctrl+K</span>
            </div>
            <div class="drop-item" @click="logout()">
              <span style="color:#9f1239;font-weight:950">ç™»å‡º</span><span class="muted">â‹</span>
            </div>
          </div>
        </template>
        <template v-else>
          <button class="chip" @click="openAuth()">ç™»å…¥</button>
        </template>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- NOTICE + INFO (ä»¿ Devs.tw) -->
    <div class="notice">
      <b>ğŸ“£</b>
      <div>
        æœ¬ç«™ç‚º Vue3 + IndexedDB çš„è«–å£‡ Demoï¼šæ”¯æ´ç™»å…¥/ç•™è¨€/è¤‡è£½ç¨‹å¼ç¢¼/åœ–ç‰‡ã€‚ä½ ä¹‹å¾Œä¸Ÿã€Œç¬¬äºŒä»½è³‡æ–™ã€æˆ‘å¯ä»¥ç›´æ¥æŠŠ seed æ–‡ç« å†åŠ é€²ä¾†ã€‚
      </div>
    </div>

    <div class="info">
      <div class="pill"></div>
      <div style="font-weight:900">DevsLite</div>
      <div class="muted">æ˜¯è®“ä½ æ•´ç†é¡Œç›®ã€å¯«è§£æ³•ã€è²¼åœ–èˆ‡è¨è«–çš„æœ¬æ©Ÿè«–å£‡ï¼ˆé‡æ•´è³‡æ–™ä¸æœƒæ¶ˆå¤±ï¼‰ã€‚</div>
      <div class="spacer"></div>
      <div class="badge blue">Vue 3</div>
      <div class="badge blue">IndexedDB</div>
      <div class="badge orange">Demo</div>
    </div>

    <div class="layout">
      <!-- LEFT -->
      <div class="panel">
        <div class="head">
          <span>è¿‘æœŸæ´»èºç”¨æˆ¶</span>
          <span class="badge">{{ activeUsers.length }}</span>
        </div>
        <div class="body">
          <div class="user-row" v-for="u in activeUsers" :key="u.id">
            <div class="uava">{{ u.username.slice(0,1).toUpperCase() }}</div>
            <div style="min-width:0">
              <div style="font-weight:900">{{ u.username }}</div>
              <div class="muted small">æœ€è¿‘ç™¼æ–‡/ç•™è¨€æ´»èº</div>
            </div>
          </div>
          <div class="hr"></div>
          <button class="btn block" @click="seedDemo()">é‡ç½®é è¨­æ–‡ç« </button>
          <button class="btn block" style="margin-top:8px" @click="wipeAll()">æ¸…ç©ºè³‡æ–™åº«ï¼ˆæ…ç”¨ï¼‰</button>
        </div>
      </div>

      <!-- CENTER -->
      <div class="panel">
        <div class="head">
          <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
            <span v-if="route==='home'">è²¼æ–‡åˆ—è¡¨</span>
            <span v-else-if="route==='post'">è²¼æ–‡å…§å®¹</span>
            <span v-else>ç™¼è¡¨æ–‡ç« </span>
            <span class="badge blue" v-if="route==='home'">{{ filteredPosts.length }} ç¯‡</span>
          </div>
          <div class="thread-actions">
            <button class="btn" v-if="route!=='home'" @click="goHome()">å›åˆ—è¡¨</button>
            <button class="btn primary" v-if="route==='home'" @click="goNew()">ï¼‹ ç™¼è¡¨</button>
          </div>
        </div>

        <div class="body">
          <!-- HOME -->
          <div v-if="route==='home'" class="list">
            <div class="post" v-for="p in filteredPosts" :key="p.id" @click="openPost(p.id)">
              <div class="row1">
                <div style="min-width:0">
                  <h3>{{ p.title }}</h3>
                  <div class="meta">
                    <span>ä½œè€…ï¼š<b>{{ p.authorName }}</b></span>
                    <span>æ™‚é–“ï¼š{{ fmt(p.createdAt) }}</span>
                    <span class="badge" v-if="p.tags?.length">{{ p.tags.join(' / ') }}</span>
                    <span class="badge orange" v-if="p.images?.length">ğŸ“· {{ p.images.length }}</span>
                    <span class="badge blue" v-if="p.code">{"</>"} Code</span>
                    <span class="muted">ç•™è¨€ï¼š{{ commentCount[p.id] || 0 }}</span>
                  </div>
                  <div class="excerpt">{{ p.body }}</div>
                </div>
              </div>
            </div>

            <div v-if="filteredPosts.length===0" class="muted">
              æ²’æœ‰ç¬¦åˆçš„æ–‡ç« ã€‚ä½ å¯ä»¥æ”¹æœå°‹é—œéµå­—æˆ–ç›´æ¥ç™¼æ–‡ã€‚
            </div>
          </div>

          <!-- POST -->
          <div v-else-if="route==='post' && activePost">
            <div style="display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;align-items:flex-start">
              <div>
                <h2 class="thread-title">{{ activePost.title }}</h2>
                <div class="meta" style="margin-top:8px">
                  <span>ä½œè€…ï¼š<b>{{ activePost.authorName }}</b></span>
                  <span>æ™‚é–“ï¼š{{ fmt(activePost.createdAt) }}</span>
                  <span class="badge" v-if="activePost.tags?.length">{{ activePost.tags.join(' / ') }}</span>
                  <span class="badge blue" v-if="activePost.language">Lang: {{ activePost.language }}</span>
                </div>
              </div>

              <div class="thread-actions">
                <button class="btn" @click="goHome()">â† å›åˆ—è¡¨</button>
                <button class="btn" v-if="activePost.code" @click="copyText(activePost.code)">è¤‡è£½ç¨‹å¼ç¢¼</button>
                <button class="btn danger" v-if="me && me.id===activePost.authorId" @click="deletePost(activePost.id)">åˆªé™¤è²¼æ–‡</button>
              </div>
            </div>

            <div class="hr"></div>

            <div style="white-space:pre-wrap;line-height:1.8;color:#374151">{{ activePost.body }}</div>

            <div class="img-grid" v-if="activePost.images?.length">
              <div class="img" v-for="(src,i) in activePost.images" :key="i">
                <img :src="src" alt="post image" />
              </div>
            </div>

            <div class="codebox" v-if="activePost.code">
              <div class="code-top">
                <div class="left">
                  <span class="badge blue">ç¨‹å¼ç¢¼</span>
                  <span class="muted small">{{ activePost.language || 'text' }}</span>
                </div>
                <button class="mini" @click="copyText(activePost.code)">ä¸€éµè¤‡è£½</button>
              </div>
              <pre><code :class="'language-'+(activePost.language || 'clike')">{{ activePost.code }}</code></pre>
            </div>

            <div class="hr"></div>

            <div style="display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;align-items:center">
              <div style="font-weight:950">ç•™è¨€ï¼ˆ{{ comments.length }}ï¼‰</div>
              <div class="badge orange" v-if="!me">ç™»å…¥å¾Œæ‰èƒ½ç•™è¨€</div>
            </div>

            <div v-if="me" class="field">
              <label>æ–°å¢ç•™è¨€</label>
              <textarea class="textarea" v-model.trim="commentDraft" placeholder="è¼¸å…¥ç•™è¨€å…§å®¹..."></textarea>
              <div style="display:flex;gap:10px;flex-wrap:wrap">
                <button class="btn" @click="commentDraft=''">æ¸…ç©º</button>
                <button class="btn primary" @click="addComment()">é€å‡ºç•™è¨€</button>
              </div>
            </div>

            <div v-for="c in comments" :key="c.id" class="comment">
              <div class="top">
                <div class="meta">
                  <span>ä½œè€…ï¼š<b>{{ c.authorName }}</b></span>
                  <span>æ™‚é–“ï¼š{{ fmt(c.createdAt) }}</span>
                </div>
                <button class="mini" v-if="me && me.id===c.authorId" @click="deleteComment(c.id)">åˆªé™¤</button>
              </div>
              <div class="body">{{ c.body }}</div>
            </div>
          </div>

          <!-- NEW POST -->
          <div v-else>
            <div v-if="!me" class="muted">
              éœ€è¦ç™»å…¥æ‰èƒ½ç™¼æ–‡ã€‚<button class="btn primary" style="margin-left:8px" @click="openAuth()">å‰å¾€ç™»å…¥</button>
            </div>

            <template v-else>
              <div class="field">
                <label>æ¨™é¡Œ</label>
                <input class="input" v-model.trim="draft.title" maxlength="80" placeholder="ä¾‹å¦‚ï¼šçŸ©é™£ç›¸ä¹˜(App04) å¡é—œ" />
              </div>

              <div class="two">
                <div class="field">
                  <label>æ¨™ç±¤ï¼ˆç”¨é€—è™Ÿåˆ†éš”ï¼‰</label>
                  <input class="input" v-model.trim="draft.tags" placeholder="Java, è³‡æ–™çµæ§‹, è¿´åœˆ" />
                </div>
                <div class="field">
                  <label>ç¨‹å¼èªè¨€</label>
                  <select class="select" v-model="draft.language">
                    <option value="java">Java</option>
                    <option value="python">Python</option>
                    <option value="javascript">JavaScript</option>
                    <option value="cpp">C++</option>
                    <option value="sql">SQL</option>
                    <option value="text">ç´”æ–‡å­—</option>
                  </select>
                </div>
              </div>

              <div class="field">
                <label>å…§æ–‡</label>
                <textarea class="textarea" v-model.trim="draft.body" placeholder="æè¿°é¡Œç›®ã€ä½ çš„æƒ³æ³•ã€æˆ–ä½ å¸Œæœ›åˆ¥äººæ€éº¼å¹«ä½ ..."></textarea>
              </div>

              <div class="two">
                <div class="field">
                  <label>åœ–ç‰‡ç¶²å€ï¼ˆå¯ç•™ç©ºï¼‰</label>
                  <input class="input" v-model.trim="draft.imageUrl" placeholder="https://..." />
                  <div class="muted small">å¦‚æœä½ è¦åƒé è¨­æ–‡ç« é‚£æ¨£ç›´æ¥å¼•ç”¨æœ¬åœ°æª”åï¼Œä¹Ÿå¯ä»¥å¡«ï¼š1.jpg</div>
                </div>
                <div class="field">
                  <label>ä¸Šå‚³åœ–ç‰‡ï¼ˆå­˜é€² IndexedDBï¼‰</label>
                  <input class="input" type="file" accept="image/*" @change="onPickImage" />
                  <div class="muted small">ä¸Šå‚³å¾Œæœƒè½‰ç‚º DataURLï¼›è«‹é¿å…å¤ªå¤§æª”ã€‚</div>
                </div>
              </div>

              <div class="field">
                <label>ç¨‹å¼ç¢¼ï¼ˆå¯ç•™ç©ºï¼‰</label>
                <textarea class="textarea" v-model="draft.code" placeholder="è²¼ä¸Šä½ çš„ code..."></textarea>
              </div>

              <div v-if="draft.previewImages.length" class="img-grid">
                <div class="img" v-for="(src,i) in draft.previewImages" :key="i">
                  <img :src="src" alt="preview" />
                </div>
              </div>

              <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
                <button class="btn" @click="resetDraft()">æ¸…ç©º</button>
                <button class="btn primary" @click="publish()">ç™¼è¡¨</button>
              </div>
            </template>
          </div>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="panel">
        <div class="head">
          <span>è¨è«–å€æœ€æ–°ç•™è¨€</span>
          <span class="badge">{{ latestReplies.length }}</span>
        </div>
        <div class="body">
          <div class="reply-row" v-for="r in latestReplies" :key="r.id" @click="openPost(r.postId)">
            <div class="uava">{{ r.authorName.slice(0,1).toUpperCase() }}</div>
            <div style="min-width:0">
              <div class="t">{{ r.postTitle }}</div>
              <div class="s">{{ r.authorName }}ï¼š{{ r.body }}</div>
            </div>
          </div>

          <div class="hr"></div>

          
        </div>
      </div>
    </div>
  </div>

  <div class="toast" v-if="toast">{{ toast }}</div>

  <!-- AUTH MODAL -->
  <div class="backdrop" v-if="authOpen" @click.self="authOpen=false">
    <div class="modal">
      <div class="mhead">
        <div>ç™»å…¥ / è¨»å†Š</div>
        <button class="x" @click="authOpen=false">é—œé–‰</button>
      </div>
      <div style="padding:12px">
        <div class="tabs">
          <div class="tab" :class="{active:authTab==='login'}" @click="authTab='login'">ç™»å…¥</div>
          <div class="tab" :class="{active:authTab==='register'}" @click="authTab='register'">è¨»å†Š</div>
        </div>

        <div class="field">
          <label>ä½¿ç”¨è€…åç¨±</label>
          <input class="input" v-model.trim="auth.username" maxlength="24" placeholder="ä¾‹å¦‚ï¼šfrank" />
        </div>
        <div class="field">
          <label>å¯†ç¢¼</label>
          <input class="input" type="password" v-model="auth.password" placeholder="è‡³å°‘ 4 ç¢¼ï¼ˆDemoï¼‰" />
        </div>

        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
          <button class="btn primary" v-if="authTab==='login'" @click="login()">ç™»å…¥</button>
          <button class="btn primary" v-else @click="register()">è¨»å†Š</button>
          <button class="btn" @click="fillDemo()">å¡«å…¥ demo/demo</button>
        </div>

        <div class="muted small" style="margin-top:10px;line-height:1.6">
          Demo èªªæ˜ï¼šå¸³å¯†å­˜æ–¼ IndexedDBï¼Œå¯†ç¢¼ä½¿ç”¨ SHA-256 + salt é›œæ¹Šï¼ˆåƒ…ä¾›ç·´ç¿’ï¼Œéæ­£å¼ä¸Šç·šå®‰å…¨æ–¹æ¡ˆï¼‰ã€‚
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/vue@3.4.35/dist/vue.global.prod.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

<!-- ä»¥ text/plain æ”¾ seed codeï¼Œé¿å… JS å­—ä¸²è½‰ç¾©å•é¡Œ -->
<script type="text/plain" id="seed-p02">
import java.util.Scanner;

public class P02 {
    public static void main(String[] args) {

        Scanner sc = new Scanner(System.in);

        // è®€ç¬¬ä¸€å€‹çŸ©é™£å¤§å°
        int r1 = sc.nextInt();
        int c1 = sc.nextInt();

        int[][] A = new int[r1][c1];
        for (int i = 0; i < r1; i++) {
            for (int j = 0; j < c1; j++) {
                A[i][j] = sc.nextInt();
            }
        }

        // è®€ç¬¬äºŒå€‹çŸ©é™£å¤§å°
        int r2 = sc.nextInt();
        int c2 = sc.nextInt();

        int[][] B = new int[r2][c2];
        for (int i = 0; i < r2; i++) {
            for (int j = 0; j < c2; j++) {
                B[i][j] = sc.nextInt();
            }
        }

        // çµæœçŸ©é™£
        int[][] C = new int[r1][c2];

        // çŸ©é™£ç›¸ä¹˜ï¼ˆä¸‰å±¤è¿´åœˆï¼‰
        for (int i = 0; i < r1; i++) {
            for (int j = 0; j < c2; j++) {
                for (int k = 0; k < c1; k++) {
                    C[i][j] += A[i][k] * B[k][j];
                }
            }
        }

        // è¼¸å‡ºçµæœ
        for (int i = 0; i < r1; i++) {
            for (int j = 0; j < c2; j++) {
                System.out.print(C[i][j]);
                if (j < c2 - 1) System.out.print(" ");
            }
            System.out.println();
        }
    }
}
</script>

<script type="text/plain" id="seed-p03">
import java.util.*;

public class P03 {
    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);
        int n = sc.nextInt();

        if (n == 0) {
            System.out.println(0);
            return;
        }
        if (n == 1 || n == 2) {
            System.out.println(1);
            return;
        }

        long[] a = new long[n + 1];
        a[0] = 0;
        a[1] = 1;
        a[2] = 1;

        for (int i = 3; i <= n; i++) {
            a[i] = a[i - 3] + a[i - 2];
        }

        System.out.println(a[n]);
    }
}
</script>

<script type="text/plain" id="seed-p04">
import java.util.*;

public class P04 {
    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);

        while (true) {
            long n = sc.nextLong();

            // è¼¸å…¥è² æ•¸å°±çµæŸ
            if (n < 0) {
                break;
            }

            long rev = 0;

            // ç‰¹åˆ¥è™•ç† n = 0
            if (n == 0) {
                System.out.println(0);
                continue;
            }

            while (n > 0) {
                rev = rev * 10 + (n % 10);
                n /= 10;
            }

            System.out.println(rev);
        }
    }
}
</script>

<script type="text/plain" id="seed-p05">
import java.util.*;

public class P05 {

    static class Student {
        int id;
        String name;
        int mid;
        int fin;
        double avg;

        Student(int id, String name, int mid, int fin) {
            this.id = id;
            this.name = name;
            this.mid = mid;
            this.fin = fin;
            this.avg = (mid + fin) / 2.0;
        }
    }

    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);

        int n = sc.nextInt();
        List<Student> list = new ArrayList<>();

        for (int i = 0; i < n; i++) {
            int id = sc.nextInt();
            String name = sc.next();
            int mid = sc.nextInt();
            int fin = sc.nextInt();
            list.add(new Student(id, name, mid, fin));
        }

        // ğŸ”¹ ä¾å­¸è™Ÿæ’åº
        List<Student> byId = new ArrayList<>(list);
        byId.sort(Comparator.comparingInt(s -> s.id));

        for (Student s : byId) {
            System.out.printf("%d-%s:%.1f%n", s.id, s.name, s.avg);
        }

        // ğŸ”¹ ä¾ç¸½æˆç¸¾æ’åºï¼ˆç”±é«˜åˆ°ä½ï¼‰
        List<Student> byScore = new ArrayList<>(byId);
        byScore.sort((a, b) -> Double.compare(b.avg, a.avg));

        for (Student s : byScore) {
            System.out.printf("%d-%s:%.1f%n", s.id, s.name, s.avg);
        }
    }
}
</script>

<script type="text/plain" id="seed-cashcard">
import java.util.Scanner;

public class Prog2 {
    public static void main(String[] args) {

        Scanner scanner = new Scanner(System.in);
        CashCard card = new CashCard();

        while (true) {
            switch (scanner.nextInt()) {
                case 1:
                    card.topUp(100);
                    break;
                case 2:
                    card.deduct(10);
                    break;
                case 3:
                    card.deduct(50);
                    break;
                case 4:
                    card.showBalance();
                    break;
                case 9:
                    System.exit(0);
                default:
                    break;
            }
        }
    }
}

class CashCard {

    private int balance;

    public CashCard() {
        balance = 0;
    }

    public void topUp(int amount) {
        balance += amount;
    }

    public void deduct(int amount) {
        if (balance < amount) {
            System.out.println("ERROR");
        } else {
            balance -= amount;
        }
    }

    public void showBalance() {
        System.out.println(balance);
    }
}
</script>

<script>
    const ua = navigator.userAgent.toLowerCase();
const isInApp =
  ua.includes('line') ||
  ua.includes('fbav') ||
  ua.includes('instagram') ||
  ua.includes('messenger') ||
  ua.includes('wv');

if (isInApp) {
  alert(
    'âš ï¸ è«‹ä½¿ç”¨ Safari æˆ– Chrome é–‹å•Ÿæ­¤ç¶²ç«™\n' +
    'LINE / IG / FB å…§å»ºç€è¦½å™¨ç„¡æ³•æ­£å¸¸åŸ·è¡Œè«–å£‡åŠŸèƒ½'
  );
}

  Prism.plugins.autoloader.languages_path = "https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/";

  const DB_NAME = "devslite_forum_db";
  const DB_VER  = 1;

  function openDB(){
    return new Promise((resolve,reject)=>{
      const req = indexedDB.open(DB_NAME, DB_VER);
      req.onupgradeneeded = () => {
        const db = req.result;

        const users = db.createObjectStore("users", { keyPath:"id", autoIncrement:true });
        users.createIndex("username", "username", { unique:true });

        const posts = db.createObjectStore("posts", { keyPath:"id", autoIncrement:true });
        posts.createIndex("createdAt", "createdAt");
        posts.createIndex("authorId", "authorId");

        const comments = db.createObjectStore("comments", { keyPath:"id", autoIncrement:true });
        comments.createIndex("postId", "postId");
        comments.createIndex("createdAt", "createdAt");

        const meta = db.createObjectStore("meta", { keyPath:"k" });
      };
      req.onsuccess = ()=>resolve(req.result);
      req.onerror = ()=>reject(req.error);
    });
  }

  function store(db, name, mode="readonly"){ return db.transaction(name, mode).objectStore(name); }
  function reqToPromise(req){ return new Promise((res,rej)=>{ req.onsuccess=()=>res(req.result); req.onerror=()=>rej(req.error); }); }

  async function sha256Hex(text){
    const enc = new TextEncoder();
    const buf = await crypto.subtle.digest("SHA-256", enc.encode(text));
    return [...new Uint8Array(buf)].map(b=>b.toString(16).padStart(2,"0")).join("");
  }
  function randSalt(){
    const a = crypto.getRandomValues(new Uint8Array(16));
    return [...a].map(b=>b.toString(16).padStart(2,"0")).join("");
  }
  function fmt(ts){
    try{
      return new Intl.DateTimeFormat("zh-TW", { dateStyle:"medium", timeStyle:"short" }).format(new Date(ts));
    }catch(e){
      return new Date(ts).toLocaleString();
    }
  }
  function getText(id){ return (document.getElementById(id)?.textContent || "").trim(); }

  const { createApp, ref, reactive, computed, onMounted, nextTick, watch } = Vue;

  createApp({
    setup(){
      const db = ref(null);

      const route = ref("home"); // home | post | new
      const q = ref("");
      const filterMode = ref("all"); // all | original | series
      const panel = ref("home");

      const me = ref(null);
      const menuOpen = ref(false);

      const posts = ref([]);
      const activePostId = ref(null);
      const activePost = computed(()=>posts.value.find(p=>p.id===activePostId.value) || null);

      const comments = ref([]);
      const commentDraft = ref("");

      const commentCount = reactive({});
      const latestReplies = ref([]);

      const activeUsers = ref([]);

      const toast = ref("");
      let toastTimer = null;
      function notify(msg){
        toast.value = msg;
        clearTimeout(toastTimer);
        toastTimer = setTimeout(()=>toast.value="", 2400);
      }

      // Auth modal
      const authOpen = ref(false);
      const authTab = ref("login");
      const auth = reactive({ username:"", password:"" });

      // New post draft
      const draft = reactive({
        title:"",
        tags:"",
        language:"java",
        body:"",
        code:"",
        imageUrl:"",
        previewImages:[]
      });

      function toggleMenu(){ menuOpen.value = !menuOpen.value; }
      function goHome(){ route.value="home"; activePostId.value=null; comments.value=[]; menuOpen.value=false; nextTick(()=>Prism.highlightAll()); }
      function goNew(){ route.value="new"; menuOpen.value=false; }
      async function openPost(id){
        route.value="post";
        activePostId.value=id;
        await loadComments(id);
        await nextTick();
        Prism.highlightAll();
      }

      const filteredPosts = computed(()=>{
        const kw = q.value.trim().toLowerCase();
        let arr = posts.value.slice();

        if(filterMode.value==="original") arr = arr.filter(p=>p.isOriginal);
        if(filterMode.value==="series") arr = arr.filter(p=>p.isSeries);

        if(!kw) return arr;
        return arr.filter(p=>{
          const hay = (p.title+" "+p.body+" "+(p.tags||[]).join(" ")+" "+p.authorName).toLowerCase();
          return hay.includes(kw);
        });
      });

      async function loadPosts(){
        const s = store(db.value, "posts");
        const idx = s.index("createdAt");
        const req = idx.openCursor(null, "prev");
        const out = [];
        await new Promise((resolve,reject)=>{
          req.onsuccess = (e)=>{
            const cur = e.target.result;
            if(cur){ out.push(cur.value); cur.continue(); }
            else resolve();
          };
          req.onerror = ()=>reject(req.error);
        });
        posts.value = out;
        await refreshCommentCount();
      }

      async function refreshCommentCount(){
        const map = {};
        const s = store(db.value, "comments");
        const req = s.openCursor();
        await new Promise((resolve,reject)=>{
          req.onsuccess = (e)=>{
            const cur = e.target.result;
            if(cur){
              const c = cur.value;
              map[c.postId] = (map[c.postId] || 0) + 1;
              cur.continue();
            }else resolve();
          };
          req.onerror = ()=>reject(req.error);
        });
        Object.keys(commentCount).forEach(k=>delete commentCount[k]);
        Object.entries(map).forEach(([k,v])=>commentCount[k]=v);
        await loadLatestReplies();
      }

      async function loadComments(postId){
        const s = store(db.value, "comments");
        const idx = s.index("postId");
        const req = idx.openCursor(IDBKeyRange.only(postId), "next");
        const out = [];
        await new Promise((resolve,reject)=>{
          req.onsuccess = (e)=>{
            const cur = e.target.result;
            if(cur){ out.push(cur.value); cur.continue(); }
            else resolve();
          };
          req.onerror = ()=>reject(req.error);
        });
        comments.value = out;
      }

      async function loadLatestReplies(){
        const s = store(db.value, "comments");
        const idx = s.index("createdAt");
        const req = idx.openCursor(null, "prev");
        const out = [];
        await new Promise((resolve,reject)=>{
          req.onsuccess = (e)=>{
            const cur = e.target.result;
            if(cur && out.length < 8){
              const c = cur.value;
              const p = posts.value.find(x=>x.id===c.postId);
              out.push({
                id: c.id,
                postId: c.postId,
                postTitle: p ? p.title : "(å·²åˆªé™¤çš„è²¼æ–‡)",
                authorName: c.authorName,
                body: (c.body||"").slice(0, 26) + ((c.body||"").length>26 ? "â€¦" : "")
              });
              cur.continue();
            }else resolve();
          };
          req.onerror = ()=>reject(req.error);
        });
        latestReplies.value = out;
      }

      async function copyText(text){
        try{
          await navigator.clipboard.writeText(text);
          notify("å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿");
        }catch(e){
          notify("è¤‡è£½å¤±æ•—ï¼ˆç€è¦½å™¨æ¬Šé™é™åˆ¶ï¼‰");
        }
      }

      async function addComment(){
        if(!me.value){ openAuth(); notify("è«‹å…ˆç™»å…¥"); return; }
        if(!activePost.value){ notify("æ‰¾ä¸åˆ°è²¼æ–‡"); return; }
        const body = commentDraft.value.trim();
        if(!body){ notify("ç•™è¨€ä¸å¯ç©ºç™½"); return; }

        const s = store(db.value, "comments", "readwrite");
        await reqToPromise(s.add({
          postId: activePost.value.id,
          body,
          authorId: me.value.id,
          authorName: me.value.username,
          createdAt: Date.now()
        }));

        commentDraft.value="";
        await loadComments(activePost.value.id);
        await refreshCommentCount();
        notify("ç•™è¨€å·²é€å‡º");
      }

      async function deleteComment(id){
        const c = comments.value.find(x=>x.id===id);
        if(!c) return;
        if(!me.value || me.value.id !== c.authorId){ notify("åªèƒ½åˆªè‡ªå·±ç•™è¨€"); return; }
        const s = store(db.value, "comments", "readwrite");
        await reqToPromise(s.delete(id));
        await loadComments(activePost.value.id);
        await refreshCommentCount();
        notify("ç•™è¨€å·²åˆªé™¤");
      }

      async function deletePost(id){
        const p = posts.value.find(x=>x.id===id);
        if(!p) return;
        if(!me.value || me.value.id !== p.authorId){ notify("åªèƒ½åˆªè‡ªå·±è²¼æ–‡"); return; }

        // delete comments
        const cs = store(db.value, "comments", "readwrite");
        const idx = cs.index("postId");
        const req = idx.openCursor(IDBKeyRange.only(id));
        await new Promise((resolve,reject)=>{
          req.onsuccess = (e)=>{
            const cur = e.target.result;
            if(cur){
              cs.delete(cur.primaryKey);
              cur.continue();
            }else resolve();
          };
          req.onerror = ()=>reject(req.error);
        });

        const ps = store(db.value, "posts", "readwrite");
        await reqToPromise(ps.delete(id));

        await loadPosts();
        goHome();
        notify("è²¼æ–‡å·²åˆªé™¤");
      }

      function openAuth(){
        authOpen.value = true;
        authTab.value = "login";
        auth.username = "";
        auth.password = "";
        menuOpen.value=false;
      }
      function fillDemo(){
        auth.username="demo";
        auth.password="demo";
        notify("å·²å¡«å…¥ demo/demo");
      }
      function logout(){
        me.value=null;
        localStorage.removeItem("devslite_session");
        menuOpen.value=false;
        notify("å·²ç™»å‡º");
      }

      async function getUserByUsername(username){
        const s = store(db.value, "users");
        return await reqToPromise(s.index("username").get(username));
      }

      async function register(){
        const u = auth.username.trim();
        const p = auth.password || "";
        if(u.length < 2){ notify("å¸³è™Ÿè‡³å°‘ 2 å­—"); return; }
        if(p.length < 4){ notify("å¯†ç¢¼è‡³å°‘ 4 ç¢¼ï¼ˆDemoï¼‰"); return; }

        const exists = await getUserByUsername(u);
        if(exists){ notify("å¸³è™Ÿå·²å­˜åœ¨"); return; }

        const salt = randSalt();
        const hash = await sha256Hex(salt + ":" + p);

        const s = store(db.value, "users", "readwrite");
        const id = await reqToPromise(s.add({ username:u, salt, passwordHash:hash, createdAt: Date.now() }));
        me.value = { id, username:u };
        localStorage.setItem("devslite_session", JSON.stringify(me.value));
        authOpen.value=false;
        notify("è¨»å†ŠæˆåŠŸï¼ˆå·²ç™»å…¥ï¼‰");
      }

      async function login(){
        const u = auth.username.trim();
        const p = auth.password || "";
        const user = await getUserByUsername(u);
        if(!user){ notify("å¸³è™Ÿä¸å­˜åœ¨"); return; }

        const hash = await sha256Hex(user.salt + ":" + p);
        if(hash !== user.passwordHash){ notify("å¯†ç¢¼éŒ¯èª¤"); return; }

        me.value = { id: user.id, username: user.username };
        localStorage.setItem("devslite_session", JSON.stringify(me.value));
        authOpen.value=false;
        notify("ç™»å…¥æˆåŠŸ");
      }

      async function restoreSession(){
        try{
          const raw = localStorage.getItem("devslite_session");
          if(!raw) return;
          const s = JSON.parse(raw);
          const u = await reqToPromise(store(db.value,"users").get(s.id));
          if(u) me.value = { id:u.id, username:u.username };
          else localStorage.removeItem("devslite_session");
        }catch(e){}
      }

      function resetDraft(){
        draft.title="";
        draft.tags="";
        draft.language="java";
        draft.body="";
        draft.code="";
        draft.imageUrl="";
        draft.previewImages=[];
        notify("å·²æ¸…ç©ºè‰ç¨¿");
      }

      async function onPickImage(ev){
        const f = (ev.target.files||[])[0];
        if(!f) return;
        const dataUrl = await new Promise((res,rej)=>{
          const r = new FileReader();
          r.onload = ()=>res(r.result);
          r.onerror = ()=>rej(r.error);
          r.readAsDataURL(f);
        });
        draft.previewImages = [dataUrl];
        ev.target.value="";
      }

      async function publish(){
        if(!me.value){ openAuth(); notify("è«‹å…ˆç™»å…¥"); return; }
        if(!draft.title.trim() || !draft.body.trim()){
          notify("è«‹è‡³å°‘å¡«æ¨™é¡Œèˆ‡å…§æ–‡");
          return;
        }

        const tags = draft.tags.split(",").map(s=>s.trim()).filter(Boolean);
        const imgs = [];

        if(draft.imageUrl.trim()) imgs.push(draft.imageUrl.trim());
        if(draft.previewImages.length) imgs.push(...draft.previewImages);

        const p = {
          title: draft.title.trim(),
          body: draft.body.trim(),
          tags,
          images: imgs,
          code: draft.code || "",
          language: draft.code ? (draft.language || "text") : "",
          authorId: me.value.id,
          authorName: me.value.username,
          createdAt: Date.now(),
          isOriginal: true,
          isSeries: false
        };

        const ps = store(db.value, "posts", "readwrite");
        const id = await reqToPromise(ps.add(p));
        await loadPosts();
        resetDraft();
        notify("å·²ç™¼è¡¨");
        await openPost(id);
      }

      async function wipeAll(){
        if(!confirm("ç¢ºå®šæ¸…ç©º IndexedDB å…¨éƒ¨è³‡æ–™ï¼Ÿ")) return;
        await reqToPromise(store(db.value,"posts","readwrite").clear());
        await reqToPromise(store(db.value,"comments","readwrite").clear());
        await reqToPromise(store(db.value,"users","readwrite").clear());
        await reqToPromise(store(db.value,"meta","readwrite").clear());
        logout();
        posts.value=[];
        comments.value=[];
        latestReplies.value=[];
        Object.keys(commentCount).forEach(k=>delete commentCount[k]);
        activeUsers.value=[];
        notify("å·²æ¸…ç©ºè³‡æ–™åº«");
      }

      async function seedDemo(){
        // clear
        await reqToPromise(store(db.value,"posts","readwrite").clear());
        await reqToPromise(store(db.value,"comments","readwrite").clear());
        await reqToPromise(store(db.value,"users","readwrite").clear());
        await reqToPromise(store(db.value,"meta","readwrite").clear());

        // users
        const us = store(db.value,"users","readwrite");
        const demoSalt = "demo_salt";
        const demoHash = await sha256Hex(demoSalt + ":" + "demo");

        const userNames = ["å°¤å·è±ª", "Enox", "chenjenping", "Kevin Hou", "JuenTingShie", "demo"];
        const userIds = {};
        for(const name of userNames){
          const salt = (name==="demo") ? demoSalt : randSalt();
          const passwordHash = (name==="demo") ? demoHash : await sha256Hex(salt + ":" + "1234");
          const id = await reqToPromise(us.add({ username:name, salt, passwordHash, createdAt: Date.now()-Math.floor(Math.random()*86400000) }));
          userIds[name]=id;
        }

        // posts
        const ps = store(db.value,"posts","readwrite");
        const now = Date.now();

        const pCash = await reqToPromise(ps.add({
          title:"ç¾é‡‘å¡åŠ å€¼å•é¡Œï¼ˆCashCardï¼‰â€” switch + ç‰©ä»¶å°è£",
          body:
`é¡Œç›®ï¼šè¼¸å…¥ 1/2/3/4/9 ä»£è¡¨åŠ å€¼ã€æ‰£æ¬¾ã€æŸ¥è©¢ã€é€€å‡ºã€‚æ‰£æ¬¾ä¸è¶³è¦å° ERRORã€‚
é‡é»ï¼šCashCard é¡åˆ¥å°è£ balanceï¼Œdeduct æ™‚åšé¤˜é¡æª¢æŸ¥ã€‚`,
          tags:["Java","OOP","switch"],
          images:["1.jpg"],
          code:getText("seed-cashcard"),
          language:"java",
          authorId:userIds["å°¤å·è±ª"],
          authorName:"å°¤å·è±ª",
          createdAt: now - 1000*60*60*20,
          isOriginal:false,
          isSeries:true
        }));

        const pMat = await reqToPromise(ps.add({
          title:"çŸ©é™£ç›¸ä¹˜ï¼ˆApp04ï¼‰â€” ä¸‰å±¤è¿´åœˆå…§ç©å¯¦ä½œ",
          body:
`é¡Œç›®ï¼šè®€å…¥å…©å€‹çŸ©é™£ (r1,c1) èˆ‡ (r2,c2)ï¼Œè¼¸å‡ºç›¸ä¹˜çµæœ (r1,c2)ã€‚
é—œéµï¼šä¸‰å±¤è¿´åœˆ i/j/kï¼ŒC[i][j] += A[i][k] * B[k][j]ã€‚`,
          tags:["Java","Matrix","Loop"],
          images:["2.jpg","2-2.jpg","2-3.jpg"],
          code:getText("seed-p02"),
          language:"java",
          authorId:userIds["chenjenping"],
          authorName:"chenjenping",
          createdAt: now - 1000*60*60*30,
          isOriginal:true,
          isSeries:false
        }));

        const pSeq = await reqToPromise(ps.add({
          title:"æ•¸å­—æ¨ç®— â€” a[n] = a[n-3] + a[n-2]ï¼ˆç´¢å¼•è¼¸å…¥è¼¸å‡ºï¼‰",
          body:
`é¡Œç›®ï¼šå‰å¹¾é …å›ºå®šï¼ˆ0,1,1ï¼‰ï¼Œå¾ç¬¬ n é …é–‹å§‹ç”±å‰é¢ n-3 èˆ‡ n-2 ç›¸åŠ ã€‚
ä½œæ³•ï¼šç”¨ long[] è‡ªåº•å‘ä¸Šè¿´åœˆå¡«è¡¨ï¼Œç›´æ¥è¼¸å‡º a[n]ã€‚`,
          tags:["Java","DP","Array"],
          images:["3.jpg"],
          code:getText("seed-p03"),
          language:"java",
          authorId:userIds["Enox"],
          authorName:"Enox",
          createdAt: now - 1000*60*60*12,
          isOriginal:true,
          isSeries:false
        }));

        const pRev = await reqToPromise(ps.add({
          title:"åè½‰æ•¸å­—ï¼ˆé€£çºŒè¼¸å…¥ï¼Œé‡è² æ•¸çµæŸï¼‰",
          body:
`é¡Œç›®ï¼šæŒçºŒè®€å…¥æ•´æ•¸ï¼›è‹¥è¼¸å…¥è² æ•¸å°±åœæ­¢ï¼›å°æ¯å€‹éè² æ•¸è¼¸å‡ºåè½‰å¾Œçš„æ•´æ•¸ã€‚
æ³¨æ„ï¼šn=0 è¦ç‰¹åˆ¥è¼¸å‡º 0ã€‚`,
          tags:["Java","While","Math"],
          images:["4.jpg"],
          code:getText("seed-p04"),
          language:"java",
          authorId:userIds["Kevin Hou"],
          authorName:"Kevin Hou",
          createdAt: now - 1000*60*60*9,
          isOriginal:false,
          isSeries:true
        }));

        const pScore = await reqToPromise(ps.add({
          title:"æˆç¸¾è¨ˆç®—èˆ‡æ’åºå•é¡Œ â€” å…ˆä¾å­¸è™Ÿï¼Œå†ä¾ç¸½æˆç¸¾",
          body:
`é¡Œç›®ï¼šè¼¸å…¥ n ç­†å­¸ç”Ÿï¼ˆå­¸è™Ÿã€å§“åã€æœŸä¸­ã€æœŸæœ«ï¼‰ï¼Œè¨ˆç®—å¹³å‡ä½œç‚ºç¸½æˆç¸¾ã€‚
è¼¸å‡º 1ï¼šä¾å­¸è™Ÿå°åˆ°å¤§ï¼›è¼¸å‡º 2ï¼šä¾ç¸½æˆç¸¾é«˜åˆ°ä½ï¼ˆå°æ•¸é» 1 ä½ï¼‰ã€‚`,
          tags:["Java","Sort","Comparator"],
          images:["5.jpg","5-1.jpg"],
          code:getText("seed-p05"),
          language:"java",
          authorId:userIds["JuenTingShie"],
          authorName:"JuenTingShie",
          createdAt: now - 1000*60*60*5,
          isOriginal:true,
          isSeries:false
        }));

        // seed comments
        const cs = store(db.value,"comments","readwrite");
        await reqToPromise(cs.add({
          postId: pMat,
          body:"çŸ©é™£ç›¸ä¹˜å¦‚æœè¼¸å…¥å°ºå¯¸ä¸åˆæ³•è¦æ€éº¼è™•ç†ï¼Ÿè¦ä¸è¦å…ˆæª¢æŸ¥ c1 == r2ï¼Ÿ",
          authorId:userIds["demo"],
          authorName:"demo",
          createdAt: now - 1000*60*60*4
        }));
        await reqToPromise(cs.add({
          postId: pCash,
          body:"æ‰£æ¬¾ä¸è¶³å° ERROR ä½†ä¸æ‰£éŒ¢ï¼Œé€™é»æœ€å¸¸æ¼æ‰ã€‚",
          authorId:userIds["demo"],
          authorName:"demo",
          createdAt: now - 1000*60*60*3
        }));
        await reqToPromise(cs.add({
          postId: pScore,
          body:"æ’åºæ™‚è¦æ³¨æ„ç¬¬äºŒæ¬¡æ’åºè¦ç”¨ç¸½æˆç¸¾ descï¼Œè¼¸å‡ºæ ¼å¼è¦å°é½Šå°æ•¸ 1 ä½ã€‚",
          authorId:userIds["Enox"],
          authorName:"Enox",
          createdAt: now - 1000*60*30
        }));

        // meta flag
        await reqToPromise(store(db.value,"meta","readwrite").put({ k:"seeded", v:true }));

        // load
        await loadPosts();
        await refreshCommentCount();
        activeUsers.value = await loadActiveUsers();
        notify("é è¨­æ–‡ç« å·²å»ºç«‹ï¼ˆå¯ç”¨ demo/demo ç™»å…¥ï¼‰");
      }

      async function loadActiveUsers(){
        // ç°¡åŒ–ï¼šç›´æ¥è®€ usersï¼Œå–å‰å¹¾å€‹é¡¯ç¤º
        const s = store(db.value,"users");
        const req = s.openCursor();
        const out = [];
        await new Promise((resolve,reject)=>{
          req.onsuccess = (e)=>{
            const cur = e.target.result;
            if(cur){ out.push(cur.value); cur.continue(); }
            else resolve();
          };
          req.onerror = ()=>reject(req.error);
        });
        // ä¾ createdAt è¿‘åˆ°é ï¼ˆæ¨¡æ“¬æ´»èºï¼‰
        out.sort((a,b)=>(b.createdAt||0)-(a.createdAt||0));
        return out.slice(0, 8).map(u=>({ id:u.id, username:u.username }));
      }

      async function ensureSeed(){
        const m = store(db.value,"meta");
        const seeded = await reqToPromise(m.get("seeded"));
        const cnt = await reqToPromise(store(db.value,"posts").count());
        if(!seeded || cnt===0){
          await seedDemo();
        }else{
          await loadPosts();
          await refreshCommentCount();
          activeUsers.value = await loadActiveUsers();
        }
      }

      watch(route, async ()=>{
        await nextTick();
        Prism.highlightAll();
      });

      onMounted(async ()=>{
        db.value = await openDB();
        await ensureSeed();
        await restoreSession();

        window.addEventListener("keydown",(ev)=>{
          if((ev.ctrlKey||ev.metaKey) && ev.key.toLowerCase()==="k"){
            ev.preventDefault();
            if(me.value) goNew();
            else openAuth();
          }
        });
      });

      return {
        route, q, filterMode, panel,
        me, menuOpen,
        posts, filteredPosts, activePostId, activePost,
        comments, commentDraft,
        commentCount, latestReplies,
        activeUsers,
        toast,
        authOpen, authTab, auth,
        draft,

        fmt,
        toggleMenu, goHome, goNew, openPost,
        openAuth, fillDemo, register, login, logout,
        copyText,
        addComment, deleteComment,
        publish, resetDraft, onPickImage,
        deletePost,
        seedDemo, wipeAll
      };
    }
  }).mount("#app");
</script>
</body>
</html>
